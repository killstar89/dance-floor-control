<!-- viewer.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dance Floor Viewer</title>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; background: black; overflow: hidden; }
    #grid { display: grid; width: 100vw; height: 100vh; }
    .box {
      width: 100%;
      height: 100%;
      border: 1px solid #111;
      animation: pulse 4s ease-in-out infinite;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); filter: brightness(1); }
      50% { transform: scale(1.1); filter: brightness(1.5); }
    }
  </style>
</head>
<body>
  <div id="grid"></div>

  <script>
    const grid = document.getElementById("grid");
    const boxSize = 50;

    function createGrid(rows, cols, color) {
      grid.innerHTML = "";
      grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
      grid.style.gridTemplateRows = `repeat(${rows}, 1fr)`;

      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const box = document.createElement("div");
          box.className = "box";
          box.style.backgroundColor = getColor(color);
          grid.appendChild(box);
        }
      }
    }

    function getColor(theme) {
      const options = {
        blue: ["#0033cc", "#3399ff", "#66ccff"],
        red: ["#cc0000", "#ff3333", "#ff6666"],
        green: ["#006600", "#00cc44", "#66ff66"],
        purple: ["#4B0082", "#8A2BE2", "#DA70D6"],
        rainbow: ["#ff0000", "#ffa500", "#ffff00", "#00ff00", "#0000ff", "#4b0082", "#ee82ee"]
      };
      const list = options[theme] || [theme];
      return list[Math.floor(Math.random() * list.length)];
    }

    function turnOffGrid() {
      grid.innerHTML = "";
    }

    function updateDisplay() {
      const pattern = localStorage.getItem("dancePattern") || "spiral";
      const color = localStorage.getItem("danceColor") || "blue";
      const power = localStorage.getItem("dancePower") || "on";

      if (power === "off") {
        turnOffGrid();
        return;
      }

      const cols = Math.floor(window.innerWidth / boxSize);
      const rows = Math.floor(window.innerHeight / boxSize);

      if (pattern === "spiral") {
        createGrid(rows, cols, color);
        // Spiral logic can be improved
      } else if (pattern === "wave") {
        createGrid(rows, cols, color);
      } else if (pattern === "grid") {
        createGrid(rows, cols, color);
      } else if (pattern === "random") {
        createGrid(rows, cols, color);
      }
    }

    window.onload = () => {
      updateDisplay();
      setInterval(updateDisplay, 3000);
    };

    window.addEventListener("resize", updateDisplay);
  </script>
</body>
</html>
